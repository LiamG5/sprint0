using Microsoft.Xna.Framework;

namespace sprint0.Classes
{
	public class LinkInvulnerabilityHandler
	{
		private float invulnerabilityTimer = 0f;
		private const float INVULNERABILITY_DURATION = 1000f;
		private bool isInvulnerable = false;

		public bool IsInvulnerable => isInvulnerable;

		public void Update(GameTime gameTime)
		{
			if (isInvulnerable)
			{
				invulnerabilityTimer += (float)gameTime.ElapsedGameTime.TotalMilliseconds;

				if (invulnerabilityTimer >= INVULNERABILITY_DURATION)
				{
					EndInvulnerability();
				}
			}
		}

		public void Activate()
		{
			isInvulnerable = true;
			invulnerabilityTimer = 0f;
		}

		public void EndInvulnerability()
		{
			isInvulnerable = false;
			invulnerabilityTimer = 0f;
		}

		public Color GetFlashColor()
		{
			if (!isInvulnerable)
				return Color.White;

			if (invulnerabilityTimer < 250f)
				return Color.Red;

			int flashFrame = (int)(invulnerabilityTimer / 100f) % 2;
			return flashFrame == 0 ? Color.White : new Color(255, 255, 255, 128);
		}

		public bool IsInKnockbackPhase()
		{
			return isInvulnerable && invulnerabilityTimer < 250f;
		}

		public float GetRemainingTime()
		{
			return isInvulnerable ? INVULNERABILITY_DURATION - invulnerabilityTimer : 0f;
		}
	}
}

